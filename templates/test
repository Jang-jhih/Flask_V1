<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form id="formElem">
        <input type="text" name="firstname" value="Karam">
        <input type="text" name="lastname" value="Yousef">
        <button id="submitBtn" type="submit">Submit</button>
    </form>

    <div id="decoded"></div>
    <button id="encodeBtn">Encode</button>
    <!-- <div id="encoded"></div> -->
    <ul id="encoded" style="border: 1px solid black"></ul>


    <script>
        const encodeBtn = document.getElementById('encodeBtn'); // 綁定 encodeBtn 按鈕
        const submitBtn = document.getElementById('submitBtn'); // 綁定 submitBtn 按鈕
        const encoded = document.getElementById('encoded'); // 綁定要呈現資料的ul
        const formElem = document.getElementById('formElem'); // 綁定 form 表單
        const apiConfig = {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        }

        encodeBtn.addEventListener('click', () => {
            // 這邊是先用 https://randomuser.me/api 的假API來模擬要get的資料，你換成自己的api
            fetch('https://randomuser.me/api', apiConfig)
                .then((response) => {
                    return response.json(); // 傳回來的資料轉成json
                })
                .then((jsonData) => {
                    let liDom
                    jsonData.results.forEach((item, idx) => {
                        liDom = `
                                <li>name: ${item.name.title}. ${item.name.first}_${item.name.last}</li>
                                <li>phone: ${item.phone}</li>
                            `;
                    })
                    encoded.innerHTML = liDom;

                })
                .catch((err) => {
                    console.log('錯誤:', err);
                });
        })

        formElem.addEventListener('submit', (e) => {
            e.preventDefault();

            const data = {
                firstname: document.querySelector('input[name="firstname"]').value,
                lastname: document.querySelector('input[name="lastname"]').value,
                age: 5
            }

            fetch('/json_value', {...apiConfig, method: 'POST', body: JSON.stringify(data)})
                .then((response) =>{
                    return response.json();
                })
                .then((jsonData) => {
                    // 這邊看妳回傳的是什麼類型的data，然後做處理(類似前面)
                    console.log(jsonData);
                })
                .catch((err) => {
                    console.log('錯誤:', err);
                });
        })


        // encode.onclick = async (e) => {
        //     let response = await fetch('http://localhost:8482/encode', {
        //         method: 'GET',
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //     })

        //     let text = await response.text(); // read response body as text
        //     data = JSON.parse(text);
        //     document.querySelector("#encoded").innerHTML = text;
        //     //  document.querySelector("#encoded").innerHTML = `First name = ${data.firstname} <br/>
        //     //                                                  Last name = ${data.lastname} <br/>
        //     //                                                  Age    = ${data.age}`
        // };

        // formElem.onsubmit = async (e) => {
        //     e.preventDefault();
        //     var form = document.querySelector("#formElem");
        //     // var form = document.forms[0];

        //     data = {
        //         firstname: form.querySelector('input[name="firstname"]').value,
        //         lastname: form.querySelector('input[name="lastname"]').value,
        //         age: 5
        //     }

        //     let response = await fetch('http://localhost:8482/decode', {
        //         method: 'POST', // or 'PUT'
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //         body: JSON.stringify(data),
        //     })

        //     let text = await response.text(); // read response body as text
        //     document.querySelector("#decoded").innerHTML = text;
        // };
    </script>
</body>

</html>